#!/bin/bash
# Launch code-editor loop.  Use -g to use gvim
#
#

[[ "$1" == "-g" ]] && { EDITOR=gvim; shift; }

function promptDir {
    while true; do 
        echo "Code-edit loop" >&2
        for x in 0 1 2 3; do
            echo "$x) m$x" >&2
        done
        echo "h) home" >&2
        echo "s) shell" >&2
        echo "q) quit" >&2
        read -s -n1
        case $REPLY in
            h)
                echo "$HOME"
                return
                ;;
            q) 
                echo "--quit--"
                return
                ;;
            s) 
                $SHELL -i
                echo "--continue--"
                return
                ;;
            [0-3])
                xpr="echo \"\$Mars${REPLY}/offlines/m_eqstst\""
                export MARSTOP=$(eval "$xpr")
                eval "$xpr"
                return
        esac
    done
}

function eqstst-edit_f {
    (
        while true; do
            xdir=$(promptDir)
            if [[ $xdir == "--quit--" ]]; then
                return
            elif [[ $xdir == "--continue--" ]]; then
                continue
            fi
            cd $xdir || { echo "Error: can't cd to $xdir" >&2; read -p "Press a key to exit"; exit 1; }
            [[ -z $EDITOR ]] && EDITOR=vim
            echo "Launching $EDITOR with dir=$PWD"
            $EDITOR
            if [[ $? -ne 0 ]]; then
                echo "vim failed to load." >&2
                read
                return
            fi
            wait
        done
    )
}

if [[ -z $sourceMe ]]; then
    eqstst-edit_f
fi


